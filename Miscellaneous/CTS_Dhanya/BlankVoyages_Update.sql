select * into WorkTemp.dbo.Voyages_Upd from pesdw.dbo.pes_dw_bol(nolock)
where bol_id in
(
select bol_id from pesdw.dbo.pes_dw_cmd (nolock)
where cmd_id in (
'147842270',
'147842267',
'147842276',
'147842273',
'148069517',
'148069495',
'148068195',
'147843597',
'147854004',
'147843413',
'148069873',
'147842430',
'147842458',
'147840956',
'147840898',
'148068432',
'147839586',
'147853911',
'147853910',
'147842198',
'147853907',
'147841679',
'148069605',
'147841825',
'148068961',
'147853881',
'147853768',
'147853460',
'147839201',
'147839221',
'148068082',
'148070051',
'148070056',
'147866281',
'147843058',
'147843056',
'147866253',
'147866291',
'147843654',
'148067566',
'147869368',
'147838582',
'148067563',
'147869339',
'147869338',
'148067530',
'147869335',
'147839811',
'147839884',
'147839861',
'147869522',
'147869478',
'148069160',
'148069167',
'147841199',
'147866115',
'147869568',
'147840282',
'147840262',
'147840188',
'147840305',
'148068739',
'147842678',
'147866211',
'147842613',
'147843524',
'147843522',
'147843151',
'147843155',
'147843395',
'148070277',
'147843340',
'147853425',
'147841806',
'147841816',
'148068638',
'147840004',
'148069264',
'148069226',
'147853991',
'147841026',
'147842286',
'148067241',
'148067787',
'147838849',
'147838227',
'147838713',
'147838692',
'147853764',
'147839452',
'147839450',
'148069642',
'147841952',
'147840126',
'147853613',
'147840140',
'147853619',
'147853616',
'147843621',
'148070343',
'147854035',
'147854034',
'147854017',
'147853977',
'147853530',
'147839648',
'147841887',
'147840757',
'148068996',
'147840730',
'147853664',
'147842072',
'147841555',
'147837759',
'147837761',
'147837763',
'147837497',
'148066572',
'147836162',
'148066713',
'147836331',
'147840448',
'147853352',
'148069093',
'147841927',
'148067970',
'148067226',
'148070319',
'147857430',
'145807411',
'145725157',
'145807408',
'145725119',
'147857413',
'148069834',
'147842217',
'147841632',
'147866139',
'148068581',
'148068643',
'147866124',
'147840357',
'147853751',
'147841406',
'147841392',
'148067925',
'148067896',
'148067920',
'148067909',
'147838374',
'148067418',
'147853365',
'147838380',
'148067396',
'148067018',
'147857218',
'147857215',
'147837968',
'148067155',
'147837448',
'147837060'
))

-- blank voyages
select * from WorkTemp.dbo.Voyages_Upd (nolock)

-- ref excel for voyages
select * From [10.31.18.132].TEMP_PES.DBO.HSUD_VOYAGES  with (nolock)

SELECT DISTINCT UPD.BOL_ID,VYG.BOL_NBR,VYG.VOYAGE,CAST(SUBSTRING(VYG.VOYAGE,1,3) AS INT) AS VOYAGE_NBR
INTO  WorkTemp.dbo.VYG_UPDATE
FROM WorkTemp.dbo.Voyages_Upd UPD (nolock) ,[10.31.18.132].TEMP_PES.DBO.HSUD_VOYAGES  VYG (nolock) 
WHERE VYG.BOL_NBR =  UPD.BILL_NUMBER

BEGIN TRAN

UPDATE DW SET DW.VOYAGE = UPD.VOYAGE_NBR,MODIFY_DATE = GETDATE(),MODIFY_BY = 'DATA_DEV'
--SELECT DW.*
FROM PES_DW_BOL DW (NOLOCK),WORKTEMP.DBO.VYG_UPDATE UPD
WHERE DW.BOL_ID = UPD.BOL_ID
AND DW.BILL_NUMBER = UPD.BOL_NBR

UPDATE DWCMD SET DWCMD.MODIFY_DATE = GETDATE(),DWCMD.MODIFY_BY = 'DATA_DEV'
--SELECT DWCMD.*
FROM PES_DW_CMD DWCMD (NOLOCK),WORKTEMP.DBO.VYG_UPDATE UPD
WHERE DWCMD.BOL_ID = UPD.BOL_ID

COMMIT TRAN

--ROLLBACK TRAN

select top 10 * from pes_dw_bol (nolock)





