SELECT TOP 10 * FROM ARCHIVE_RAW_BOL (NOLOCK)
WHERE CARRIER_CODE = 'HRZD'

SELECT TOP 10 * FROM ARCHIVE_RAW_PTY (NOLOCK)
WHERE CARRIER_CODE = 'HRZD'


SELECT * FROM RAW_PTY (NOLOCK) WHERE CARRIER_CODE = 'HRZD'


sp_helptext PES_LOAD_LIB_TRANSACTIONS_INTO_STG_PTY 

select * from raw_pty (nolock) where name = 'order'
and bol_number like 'HRZD%'

select * from raw_bol (nolock) where bol_id  = 257348033



select bol_id,impexp,* from PES.dbo.ARCHIVE_RAW_BOL(nolock) where bol_id in (238259772,238259765,238259755,244544829)

select distinct source,count(*) from PES.dbo.ARCHIVE_RAW_PTY(nolock) where name = 'order'
group by source

select * from PES.dbo.ARCHIVE_RAW_PTY(nolock) where bol_id in (238259772,238259765,238259755,244544829)
select * from PES_PURGE.dbo.ARCHIVE_PES_STRUCTURED_PTY(nolock) where bol_id in (238259772,238259765,238259755,244544829)


select BOL_ID,COMP_ID,FCOMP_ID,NTFCOMP_ID,ULT_PORT_CODE,ULT_PORT_NAME,SCAC,

PORT_OF_DESTINATION,FOREIGN_LOADING_PORT,* from PES.dbo.PES_STG_BOL(nolock)

where bol_id in (238259772,238259765,238259755,244544829)

 

select STG_PTY_ID,BOL_ID,COMP_ID,SOURCE,MODIFIED_DT,MODIFIED_BY, * FROM PEs.dbo.PES_STG_PTY(nolock)

where bol_id in (238259772,238259765,238259755,244544829)


select * from  PES_RESTRICTION_CODES   (nolock) 

select STG_PTY_ID,BOL_ID,COMP_ID,SOURCE,MODIFIED_DT,MODIFIED_BY, * FROM PEs.dbo.PES_STG_PTY(nolock)

where bol_id in (238259772,238259765,238259755,244544829)

select fcomp_id,* from pes_stg_bol (nolock) 

PES_STRUCTURED_PTY
 
Step called: CTRL_O_LOAD_PES_STG_PTY_COMPANY_STANDARDIZATION_RECORDS  where EXEC PES_LOAD_LIB_TRANSACTIONS_INTO_STG_PTY is being called in SSIS Package:-PES_UPDATE_STAGING.dtsx
 


SELECT A.BOL_ID,'C' AS SOURCE,'ORDER' AS NAME,A.LOAD_NUMBER,A.BOL_NUMBER FROM RAW_BOL A 
WHERE A.BOL_ID NOT IN(SELECT BOL_ID FROM RAW_PTY WHERE SOURCE='C') AND A.IMPEXP='I' 
UNION
SELECT A.BOL_ID,'S' AS SOURCE,'ORDER' AS NAME,A.LOAD_NUMBER,A.BOL_NUMBER FROM RAW_BOL A 
WHERE A.BOL_ID NOT IN(SELECT BOL_ID FROM RAW_PTY WHERE SOURCE='S') AND A.IMPEXP='I' 
UNION
SELECT A.BOL_ID,'S' AS SOURCE,'ORDER' AS NAME,A.LOAD_NUMBER,A.BOL_NUMBER FROM RAW_BOL A 
WHERE A.BOL_ID NOT IN(SELECT BOL_ID FROM RAW_PTY WHERE SOURCE='S') AND A.IMPEXP='E'

-- company_hub

--UPDATE COMPANY NAME IN PES_STRUCTURED_PTY FROM RAW_PTY

UPDATE PES_STRUCTURED_PTY SET PES_STRUCTURED_PTY.NAME=A.NAME
FROM RAW_PTY A WHERE A.RAW_PTY_ID=
PES_STRUCTURED_PTY.RAW_PTY_ID AND PES_STRUCTURED_PTY.STR_PTY_STATUS='READY FOR HUB'
AND LEN(ISNULL(A.NAME,''))<=35


sp_helptext  PES_LOAD_LIB_TRANSACTIONS_INTO_STG_PTY 


------------------------------------------------------------------------------

SELECT  RAW_PTY_ID,A.BOL_ID,B.BOL_Number, B.IMPEXP DIR, Pty_seq_nbr,comment,Source,Name,
		Addr_1,Addr_2,Addr_3,Addr_4,A.Load_Number,Created_By,Created_Dt,Modified_By,Modified_Dt 
FROM RAW_PTY A,RAW_BOL B 
WHERE A.BOL_ID =B.BOL_ID AND B.INVALIDBILLFLAG IS NULL
ORDER BY A.RAW_PTY_ID

-- Missed Company Records
SELECT TOP 10 A.BOL_ID,'C' AS SOURCE,'ORDER' AS NAME,A.LOAD_NUMBER,A.BOL_NUMBER FROM ARCHIVE_RAW_BOL A (nolock) WHERE A.BOL_ID NOT IN(SELECT BOL_ID FROM ARCHIVE_RAW_PTY (nolock) WHERE SOURCE='C') AND A.IMPEXP='I' 
UNION
SELECT TOP 10 A.BOL_ID,'S' AS SOURCE,'ORDER' AS NAME,A.LOAD_NUMBER,A.BOL_NUMBER FROM ARCHIVE_RAW_BOL A (nolock) WHERE A.BOL_ID NOT IN(SELECT BOL_ID FROM ARCHIVE_RAW_PTY (nolock) WHERE SOURCE='S') AND A.IMPEXP='I' 
UNION
SELECT TOP 10 A.BOL_ID,'S' AS SOURCE,'ORDER' AS NAME,A.LOAD_NUMBER,A.BOL_NUMBER FROM ARCHIVE_RAW_BOL A (nolock) WHERE A.BOL_ID NOT IN(SELECT BOL_ID FROM ARCHIVE_RAW_PTY (nolock) WHERE SOURCE='S') AND A.IMPEXP='E'



SELECT A.BOL_ID,'C' AS SOURCE,'ORDER' AS NAME,A.LOAD_NUMBER,A.BOL_NUMBER


SELECT * FROM ARCHIVE_RAW_BOL A (nolock) 
WHERE BOL_ID IN 
(238259772,238259765,238259755,244544829)

SELECT * FROM ARCHIVE_RAW_PTY A (nolock) 
WHERE BOL_ID IN 
(238259772,238259765,238259755,244544829)

SELECT TOP 10 * FROM PES_STRUCTURED_PTY A (nolock) 
WHERE NAME = 'ORDER' AND BOL_ID IN (SELECT BOL_ID FROM ARCHIVE_RAW_BOL A (nolock) 
WHERE CARRIER_CODE = 'HRZD')  
-- AND CITY = '' AND ST = ''




SELECT * FROM PES_STRUCTURED_PTY A (nolock) 
WHERE BOL_ID IN 
(238259772,238259765,238259755,244544829)



SELECT * FROM ARCHIVE_RAW_BOL A (nolock) 
WHERE BOL_ID IN (
243303664,243313411,243311197,243315006,243312766,243312139,243305727,243297651,243320629,243297657)

SELECT * FROM ARCHIVE_RAW_PTY A (nolock) 
WHERE BOL_ID IN (
243303664,243313411,243311197,243315006,243312766,243312139,243305727,243297651,243320629,243297657)


SELECT * FROM PES_STRUCTURED_PTY A (nolock) 
WHERE BOL_ID IN (
243303664,243313411,243311197,243315006,243312766,243312139,243305727,243297651,243320629,243297657)

SELECT A.RAW_PTY_ID,A.BOL_ID,'ORDER' AS NAME,A.SOURCE,B.IMPEXP AS DIRECTION 
FROM archive_RAW_PTY A,archive_RAW_BOL B 
WHERE A.BOL_ID=B.BOL_ID 
AND B.INVALIDBILLFLAG IS NULL 
AND B.IMPEXP='I' AND A.RAW_PTY_ID 
NOT IN(SELECT RAW_PTY_ID FROM PES_STRUCTURED_PTY 
        WHERE BOL_ID IN (SELECT BOL_ID FROM archive_RAW_BOL WHERE INVALIDBILLFLAG IS NULL)
	   ) 
AND A.BOL_ID IN (
243303664,243313411,243311197,243315006,243312766,243312139,243305727,243297651,243320629,243297657)



UNION

SELECT A.RAW_PTY_ID,A.BOL_ID,'ORDER' AS NAME,A.SOURCE,B.IMPEXP AS DIRECTION FROM RAW_PTY A,RAW_BOL B 
WHERE A.BOL_ID=B.BOL_ID AND B.INVALIDBILLFLAG IS NULL AND B.IMPEXP='E' AND A.SOURCE='S' AND A.RAW_PTY_ID 
NOT IN(SELECT RAW_PTY_ID FROM PES_STRUCTURED_PTY WHERE BOL_ID IN
(SELECT BOL_ID FROM RAW_BOL WHERE INVALIDBILLFLAG IS NULL))


(DIRECTION == "I" && (SOURCE == "C" || SOURCE == "N" || SOURCE == "A") && NAME == "ORDER") ? "XX" 
: (DIRECTION == "I" && SOURCE == "S" && NAME == "ORDER") ? "ZZ" : (DIRECTION == "E" && SOURCE == "S" && NAME == "ORDER") ? "XX" : ""



SELECT *
   FROM [PES].[DBO].ARCHIVE_RAW_PTY  (NOLOCK)
   WHERE EXISTS (SELECT 1  
        FROM TEMP_PES.DBO.HOR_PTY_SEP7   (NOLOCK) 
        WHERE [PES].DBO.ARCHIVE_RAW_PTY.RAW_PTY_ID = RAW_PTY_ID AND [PES].DBO.ARCHIVE_RAW_PTY.RAW_PTY_ID <> MINRAWPTYID
				AND ISNULL([PES].DBO.ARCHIVE_RAW_PTY.PTY_SEQ_NBR,0) = 0)