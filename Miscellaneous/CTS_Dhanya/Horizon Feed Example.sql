select * into temp_pes.dbo.pes_structured_pty_09_06_2012 from pes_structured_pty (nolock)
where bol_id  in (select bol_id from temp_pes.dbo.raw_pty_09_06_2012)

select * into temp_pes.dbo.raw_bol_09_06_2012 from raw_bol (nolock)
where bol_id  in (select bol_id from temp_pes.dbo.raw_pty_09_06_2012)

select * from raw_pty (nolock)
where bol_id = 257360036


select * into temp_pes.dbo.raw_pty_09_06_2012 from raw_pty (nolock)
where name  = 'order'


SELECT A.BOL_ID,'C' AS SOURCE,'ORDER' AS NAME,A.LOAD_NUMBER,A.BOL_NUMBER FROM RAW_BOL A 
WHERE A.BOL_ID NOT IN(SELECT BOL_ID FROM RAW_PTY WHERE SOURCE='C') AND A.IMPEXP='I' 

SELECT A.RAW_PTY_ID,A.BOL_ID,'ORDER' AS NAME,A.SOURCE,B.IMPEXP AS DIRECTION FROM RAW_PTY A,RAW_BOL B 
WHERE A.BOL_ID=B.BOL_ID AND B.INVALIDBILLFLAG IS NULL AND B.IMPEXP='I' AND A.RAW_PTY_ID 
NOT IN(SELECT RAW_PTY_ID FROM PES_STRUCTURED_PTY WHERE BOL_ID IN(SELECT BOL_ID FROM RAW_BOL WHERE INVALIDBILLFLAG IS NULL)) 






-- 68686
select count(*) from raw_pty (nolock) 

-- 19750
select count(*) from raw_pty (nolock) where name = 'order'

select * from raw_pty (nolock) where name <> 'order'
AND BOL_NUMBER = '26004404791'

-- RAW_BOL (IMPORTS)

SELECT * FROM RAW_BOL  
WHERE BOL_ID IN (
257360065,
257360066,
257360069,
257360074,
257360075)

-- RAW PTY

SELECT * FROM RAW_PTY where name = 'order'

WHERE BOL_ID IN (
257360065,
257360066,
257360069,
257360074,
257360075)


-- 1230 ROWS
SELECT * FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE 
 NAME = 'ORDER'



SELECT * FROM PES_PROGRESS_STATUS (NOLOCK)
WHERE LOADNUMBER IN (
SELECT DISTINCT LOAD_NUMBER FROM ARCHIVE_RAW_BOL (NOLOCK) 
WHERE BOL_NUMBER LIKE 'HRZD%' AND BOL_ID IN (SELECT BOL_ID FROM ARCHIVE_RAW_PTY  (NOLOCK) 
WHERE NAME = 'ORDER'))
ORDER BY LOAD_DT DESC


WHERE BOL_ID IN  (SELECT BOL_ID FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE NAME = 'ORDER')
ORDER BY SAILING_DATE DESC

-- HORIZON FEED
-- E:\PIERS Enterprise Solution\Output\SSISFiles\ISISMerge
-- BOL_34d88426-7e7c-403f-b3b6-3a48443ad347.txt
-- Loadnumber 12236002

SELECT * FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE LOAD_NUMBER = 12236002
AND NAME = 'ORDER' AND SOURCE = 'S'

SELECT * FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE 
NAME = 'ORDER' AND SOURCE = 'C' AND BOL_NUMBER LIKE 'HRZD%'

SELECT * FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE 
NAME = 'ORDER' AND SOURCE = 'S' AND BOL_NUMBER LIKE 'HRZD%'

SELECT * FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE 
 BOL_NUMBER IN (
'HRZD474283097','HRZD474283096','HRZD474283094')

SELECT * FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE 
 BOL_NUMBER ='HRZD474283005'

SELECT IMPEXP,* FROM ARCHIVE_RAW_BOL (NOLOCK) WHERE BOL_NUMBER IN (
'HRZD474283097','HRZD474283096','HRZD474283094')

SELECT * FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE BOL_ID IN
(SELECT BOL_ID FROM ARCHIVE_RAW_BOL (NOLOCK) WHERE LOAD_NUMBER = 12236002)
AND SOURCE = 'S' AND NAME = 'ORDER'
ORDER BY RAW_PTY_ID


SELECT * FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE BOL_NUMBER IN (
'HRZD474283097','HRZD474283096','HRZD474283094')

SELECT * FROM PES_STRUCTURED_PTY (NOLOCK) WHERE BOL_ID 
IN (SELECT BOL_ID FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE BOL_NUMBER IN (
'HRZD474283097','HRZD474283096','HRZD474283094'))

SELECT * FROM PES_TRANSACTIONS_REF_PTY (NOLOCK)
WHERE BOL_ID IN (
256472511,
256472512,
256472513,
256472511,
256472512,
256472513)


SELECT * FROM PES.DBO.PES_STG_PTY(NOLOCK)
WHERE BOL_ID IN 
(
256472511,
256472512,
256472513,
256472511,
256472512,
256472513)

SELECT COMP_ID,NAME,CAST(DBO.PES_UDF_REMOVE_SPECIAL_CHARACTERS(NAME) AS VARCHAR(150)) NAME1,ADDRESS1,CITY,STATE FROM
PES_LIB_COMPANY   WITH (NOLOCK)  
WHERE LTRIM(RTRIM(ISNULL(NAME,'')))<>'' AND
LTRIM(RTRIM(ISNULL(CITY,''))) NOT IN('','ZZ','XX')
AND LTRIM(RTRIM(STATE)) NOT IN('ZZ','','XX')
AND MATCH_FLAG=1
ORDER BY NAME1,ADDRESS1,CITY,STATE

SELECT C.STR_PTY_ID,C.BOL_ID,C.NAME,CAST(DBO.PES_UDF_REMOVE_SPECIAL_CHARACTERS(C.NAME) AS VARCHAR(150)) NAME1,
C.ADDR_1,C.CITY,C.ST 
FROM PES_STRUCTURED_PTY C  WITH (NOLOCK)   JOIN ARCHIVE_RAW_BOL R   WITH (NOLOCK)   ON C.BOL_ID=R.BOL_ID 
WHERE (ISNULL(C.CTRY_CODE,'')<>'CA' AND ((R.IMPEXP='I' AND C.SOURCE <> 'S') OR R.IMPEXP='E')) AND C.STR_PTY_STATUS 
='CLEANSED_PTY' ORDER BY NAME1,C.ADDR_1,C.CITY,C.ST

-- BLOCK COMPID = 31000002

SELECT * FROM PES_REF_COMPANY (NOLOCK) 
WHERE COMP_ID IN (
31000002,
35274447,
31000002,
17152408,
31000002,
17152408 )




-- loadnumber = 12236002



INSERT INTO PES_AUDIT_DETAILS
(TABLE_NAME,BOL_ID,CHILD_ID,LOAD_NUMBER,REJECTED_AT,[DATE],[ERRORCODE],[ERRORDESCRIPTION],[ERRORCOLUMN])
VALUES
('RAW_PTY',?,?,?,'S',GETDATE(),?,?,?)




WHERE TABLE_NAME  = 'RAW_PTY'
 ORDER BY DATE DESC





2~14~HRZD474283096~CARIBBEAN REFRESCOS~~~Cidra,PR~
2~15~HRZD474283094~CARIBBEAN REFRESCOS~~~Cidra,PR~
2~16~HRZD474283093~CARIBBEAN REFRESCOS~~~Cidra,PR~
2~17~HRZD474283092~CARIBBEAN REFRESCOS~~~Cidra,PR~




SELECT * FROM ARCHIVE_RAW_BOL (NOLOCK) WHERE BOL_NUMBER = 'HRZD474283152'
SELECT * FROM ARCHIVE_RAW_PTY (NOLOCK) WHERE BOL_NUMBER = 'HRZD474283152'

256472501


WHERE BOL_NUMBER = 'US1227564'

----------------------------
EXAMPLE
----------------------------

-- IMPORT AMS FEED LOADNUMBER 12246001
-- UNRESTRICTED COMPANY
SELECT * FROM RAW_BOL WHERE BOL_NUMBER = 'COSU6045701990'
SELECT * FROM RAW_PTY WHERE BOL_NUMBER = 'COSU6045701990'

-- PES_STRUCTURED_PTY -- TRANSACTIONS.TXT
SELECT * FROM PES_STRUCTURED_PTY WHERE BOL_ID = 257360037

-- RESTRICTED COMPANY

SELECT  R1.BOL_ID,R1.NAME,R1.SOURCE,R2.SOURCE,R2.NAME 
FROM ARCHIVE_RAW_PTY (NOLOCK) R1,ARCHIVE_RAW_PTY (NOLOCK) R2
WHERE R1.BOL_ID = R2.BOL_ID
AND R1.NAME = 'ORDER' AND R1.SOURCE = 'S'
AND R2.SOURCE = 'C' AND R2.NAME <> 'ORDER'

SELECT BOL_ID,* FROM ARCHIVE_RAW_PTY (NOLOCK)
WHERE NAME = 'ORDER OF SHIPPER'

SELECT BOL_ID,* FROM ARCHIVE_RAW_PTY (NOLOCK)
WHERE NAME LIKE '%ASCONSIGNEE%'


SELECT IMPEXP,* FROM RAW_BOL WHERE BOL_NUMBER = 'CLAMSTDN2M007545'
SELECT * FROM RAW_PTY WHERE BOL_NUMBER = 'CLAMSTDN2M007545'

-- LOAD MISSING TRANSACTIONS FROM RAW_PTY TO PES_STRUCTURED_PTY 
-- MISSING IN TRANSACTIONS.TXT
-- DUPLICATE BILL DELETED AND COMPANY RESTRICTED
SELECT * FROM PES_STRUCTURED_PTY WHERE BOL_ID IN (257387604,257387607)

SELECT ROUTINE_NAME, ROUTINE_DEFINITION 
    FROM INFORMATION_SCHEMA.ROUTINES 
    WHERE ROUTINE_DEFINITION LIKE '%UPDATE RAW_PTY%' 
	--AND ROUTINE_DEFINITION LIKE '%UPDATE%' 
    AND ROUTINE_TYPE='PROCEDURE' 


SELECT * FROM ARCHIVE_RAW_PTY 
WHERE RAW_PTY_ID = 114936869


114939536
114936870





  

